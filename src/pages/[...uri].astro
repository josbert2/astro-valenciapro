---
import '../styles/global.css';
import { getNodeByURI } from '../lib/api';

export const prerender = false;

const { uri } = Astro.params;
const { nodeByUri } = await getNodeByURI(`/${uri}/`);

if (!nodeByUri) {
    return Astro.redirect('/404');
}

const post = nodeByUri;
---

<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{post.title}</title>
    </head>

    <body class="bg-gray-100 min-h-screen">
        <article class="max-w-3xl mx-auto px-4 py-12">
            <!-- BotÃ³n volver -->
            <a 
                href="/" 
                class="inline-flex items-center text-blue-600 hover:text-blue-800 mb-8 transition-colors"
            >
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Volver al blog
            </a>

            <!-- Imagen destacada -->
            {post.featuredImage && (
                <img 
                    src={post.featuredImage.node.sourceUrl} 
                    alt={post.featuredImage.node.altText || post.title}
                    class="w-full h-64 md:h-96 object-cover rounded-2xl mb-8"
                />
            )}

            <!-- Header -->
            <header class="mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">{post.title}</h1>
                
                {post.date && (
                    <time class="text-gray-500">
                        {new Date(post.date).toLocaleDateString('es-ES', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        })}
                    </time>
                )}

                {post.categories?.nodes?.length > 0 && (
                    <div class="flex gap-2 mt-4">
                        {post.categories.nodes.map((cat) => (
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                {cat.name}
                            </span>
                        ))}
                    </div>
                )}
            </header>

            <!-- Contenido -->
            <div 
                class="prose prose-lg max-w-none prose-headings:text-gray-900 prose-p:text-gray-700 prose-a:text-blue-600"
                set:html={post.content}
            />
        </article>
    </body>
</html>
